const TelegramBot = require('node-telegram-bot-api');
require('dotenv').config();

const token = process.env.BOT_TOKEN;

if (!token) {
    console.error('‚ùå –û—à–∏–±–∫–∞: BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!');
    console.log('üìù –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –∏ –¥–æ–±–∞–≤—å—Ç–µ: BOT_TOKEN=your_bot_token_here');
    process.exit(1);
}

const bot = new TelegramBot(token, { polling: true });

// –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∫–≤–∏–∑–∞
const userStates = new Map();

// –ü—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
const programs = {
    'sushka_pro': {
        name: '–°—É—à–∫–∞ PRO',
        price: '8,000 ‚ÇΩ',
        description: '–ú–æ—â–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¢–∞–±–∞—Ç–∞ –¥–ª—è —Å–∂–∏–≥–∞–Ω–∏—è –∂–∏—Ä–∞ –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –º—ã—à—Ü',
        features: ['–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏', '–°–∂–∏–≥–∞–Ω–∏–µ –¥–æ 500 –∫–∫–∞–ª –∑–∞ —Å–µ—Å—Å–∏—é', '–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≥—Ä—É–ø–ø –º—ã—à—Ü']
    },
    'sila_tonus': {
        name: '–°–∏–ª–∞ –∏ –¢–æ–Ω—É—Å',
        price: '6,000 ‚ÇΩ ‚Üí 4,200 ‚ÇΩ',
        description: '–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º—ã—à—Ü-—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –æ—Å–∞–Ω–∫–∏',
        features: ['–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–æ—Ä–ø—É—Å–∞', '–£–ª—É—á—à–µ–Ω–∏–µ –æ—Å–∞–Ω–∫–∏', '–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è —Å—É—Å—Ç–∞–≤–æ–≤']
    },
    'stalnoy_press': {
        name: '–°—Ç–∞–ª—å–Ω–æ–π –ø—Ä–µ—Å—Å',
        price: '7,200 ‚ÇΩ',
        description: '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –º—ã—à—Ü –∂–∏–≤–æ—Ç–∞',
        features: ['–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ—Å—Å–∞', '–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–æ—Ä–ø—É—Å–∞', '–£–ª—É—á—à–µ–Ω–∏–µ –æ—Å–∞–Ω–∫–∏']
    },
    'trx_balance': {
        name: 'TRX –ë–∞–ª–∞–Ω—Å',
        price: '8,000 ‚ÇΩ ‚Üí 5,600 ‚ÇΩ',
        description: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å TRX –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏ —Å–∏–ª—ã',
        features: ['TRX —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', '–†–∞–∑–≤–∏—Ç–∏–µ –±–∞–ª–∞–Ω—Å–∞', '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞']
    },
    'posle_rodov': {
        name: '–ù–æ–≤–æ–µ —Ç–µ–ª–æ –ø–æ—Å–ª–µ —Ä–æ–¥–æ–≤',
        price: '13,000 ‚ÇΩ',
        description: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–æ–¥–æ–≤ –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º—ã—à—Ü —Ç–∞–∑–æ–≤–æ–≥–æ –¥–Ω–∞',
        features: ['–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º—ã—à—Ü —Ç–∞–∑–∞', '–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–æ—Ä–ø—É—Å–∞', '–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è']
    },
    'rastyazhka': {
        name: '–†–∞—Å—Ç—è–∂–∫–∞ –∏ —à–ø–∞–≥–∞—Ç',
        price: '7,000 ‚ÇΩ',
        description: '–†–∞–∑–≤–∏—Ç–∏–µ –≥–∏–±–∫–æ—Å—Ç–∏, —É–ª—É—á—à–µ–Ω–∏–µ –æ—Å–∞–Ω–∫–∏ –∏ –æ—Å–≤–æ–µ–Ω–∏–µ —à–ø–∞–≥–∞—Ç–∞',
        features: ['–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥–∏–±–∫–æ—Å—Ç–∏', '–£–ª—É—á—à–µ–Ω–∏–µ –æ—Å–∞–Ω–∫–∏', '–û—Å–≤–æ–µ–Ω–∏–µ —à–ø–∞–≥–∞—Ç–∞']
    },
    'analiz_pitaniya': {
        name: '–ê–Ω–∞–ª–∏–∑ –ø–∏—Ç–∞–Ω–∏—è',
        price: '5,000 ‚ÇΩ',
        description: '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–∏—Ç–∞–Ω–∏—è –∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è',
        features: ['–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞', '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', '–ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è']
    }
};

// –í–æ–ø—Ä–æ—Å—ã –∫–≤–∏–∑–∞
const quizQuestions = [
    {
        question: 'üéØ –ö–∞–∫–∞—è —É –≤–∞—Å –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å?',
        options: [
            { text: 'üî• –ü–æ—Ö—É–¥–µ–Ω–∏–µ', value: 'weight_loss' },
            { text: 'üí™ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º—ã—à—Ü', value: 'muscle_strength' },
            { text: 'üë∂ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–æ–¥–æ–≤', value: 'post_pregnancy' },
            { text: 'ü§∏ –ì–∏–±–∫–æ—Å—Ç—å –∏ —Ä–∞—Å—Ç—è–∂–∫–∞', value: 'flexibility' },
            { text: 'ü•ó –ü–∏—Ç–∞–Ω–∏–µ –∏ –¥–∏–µ—Ç–∞', value: 'nutrition' }
        ]
    },
    {
        question: '‚è∞ –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –≤—ã –≥–æ—Ç–æ–≤—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è?',
        options: [
            { text: '1-2 —Ä–∞–∑–∞', value: '1-2' },
            { text: '3-4 —Ä–∞–∑–∞', value: '3-4' },
            { text: '5-6 —Ä–∞–∑', value: '5-6' },
            { text: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ', value: 'daily' }
        ]
    },
    {
        question: 'üè† –ì–¥–µ –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è?',
        options: [
            { text: 'üè° –î–æ–º–∞', value: 'home' },
            { text: 'üèãÔ∏è –í –∑–∞–ª–µ', value: 'gym' },
            { text: 'üå≥ –ù–∞ —É–ª–∏—Ü–µ', value: 'outdoor' },
            { text: 'üìç –õ—é–±–æ–µ –º–µ—Å—Ç–æ', value: 'anywhere' }
        ]
    },
    {
        question: 'üìä –ö–∞–∫–æ–π —É –≤–∞—Å —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏?',
        options: [
            { text: 'üÜï –ù–∞—á–∏–Ω–∞—é—â–∏–π', value: 'beginner' },
            { text: 'üìà –ï—Å—Ç—å –æ–ø—ã—Ç', value: 'intermediate' },
            { text: 'üí™ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π', value: 'advanced' }
        ]
    },
    {
        question: 'üöÄ –ß—Ç–æ –≤–∞—Å –±–æ–ª—å—à–µ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç?',
        options: [
            { text: '‚ö° –ë—ã—Å—Ç—Ä—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã', value: 'fast_results' },
            { text: 'üìà –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ', value: 'gradual_progress' },
            { text: 'üë• –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–µ–Ω–µ—Ä–∞', value: 'trainer_support' }
        ]
    }
];

// –õ–æ–≥–∏–∫–∞ –ø–æ–¥–±–æ—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤
function recommendProgram(answers) {
    const { goal, frequency, location, level, motivation } = answers;
    
    if (goal === 'weight_loss') return 'sushka_pro';
    if (goal === 'post_pregnancy') return 'posle_rodov';
    if (goal === 'muscle_strength') return 'sila_tonus';
    if (goal === 'flexibility') return 'rastyazhka';
    if (goal === 'nutrition') return 'analiz_pitaniya';
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
    if (level === 'advanced' && frequency === 'daily') return 'sushka_pro';
    if (level === 'beginner') return 'sila_tonus';
    
    return 'sila_tonus'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
}

// –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
function getMainMenu() {
    return {
        reply_markup: {
            keyboard: [
                ['üß† –ü—Ä–æ–π—Ç–∏ –∫–≤–∏–∑', 'üìã –ü—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫'],
                ['üë©‚Äçüíº –û —Ç—Ä–µ–Ω–µ—Ä–µ', 'üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã'],
                ['‚≠ê –û—Ç–∑—ã–≤—ã', '‚ùì FAQ']
            ],
            resize_keyboard: true,
            one_time_keyboard: false
        }
    };
}

// –ú–µ–Ω—é –ø—Ä–æ–≥—Ä–∞–º–º
function getProgramsMenu() {
    const programsList = Object.entries(programs).map(([key, program]) => 
        `‚Ä¢ ${program.name} - ${program.price}`
    ).join('\n');
    
    return {
        reply_markup: {
            inline_keyboard: [
                [
                    { text: 'üî• –°—É—à–∫–∞ PRO', callback_data: 'program_sushka_pro' },
                    { text: 'üí™ –°–∏–ª–∞ –∏ –¢–æ–Ω—É—Å', callback_data: 'program_sila_tonus' }
                ],
                [
                    { text: 'üèãÔ∏è –°—Ç–∞–ª—å–Ω–æ–π –ø—Ä–µ—Å—Å', callback_data: 'program_stalnoy_press' },
                    { text: 'ü§∏ TRX –ë–∞–ª–∞–Ω—Å', callback_data: 'program_trx_balance' }
                ],
                [
                    { text: 'üë∂ –ü–æ—Å–ª–µ —Ä–æ–¥–æ–≤', callback_data: 'program_posle_rodov' },
                    { text: 'ü§∏ –†–∞—Å—Ç—è–∂–∫–∞', callback_data: 'program_rastyazhka' }
                ],
                [
                    { text: 'ü•ó –ê–Ω–∞–ª–∏–∑ –ø–∏—Ç–∞–Ω–∏—è', callback_data: 'program_analiz_pitaniya' }
                ],
                [
                    { text: 'üìû –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É', callback_data: 'book_program' }
                ],
                [
                    { text: 'üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é', callback_data: 'back_to_menu' }
                ]
            ]
        }
    };
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;
    const firstName = msg.from.first_name;
    
    const welcomeMessage = `üëã –ü—Ä–∏–≤–µ—Ç, ${firstName}!

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä–∞ –õ–∏–ª–∏–∏ –Ø—Ü–∫–æ–π! üí™

–Ø –ø–æ–º–æ–≥—É –≤–∞–º:
‚Ä¢ üß† –ü–æ–¥–æ–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
‚Ä¢ üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
‚Ä¢ üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å —Ç—Ä–µ–Ω–µ—Ä–æ–º
‚Ä¢ ‚ùì –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–µ–Ω—é –Ω–∏–∂–µ:`;

    bot.sendMessage(chatId, welcomeMessage, getMainMenu());
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('message', (msg) => {
    const chatId = msg.chat.id;
    const text = msg.text;
    
    if (text === 'üß† –ü—Ä–æ–π—Ç–∏ –∫–≤–∏–∑') {
        startQuiz(chatId);
    } else if (text === 'üìã –ü—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫') {
        showPrograms(chatId);
    } else if (text === 'üë©‚Äçüíº –û —Ç—Ä–µ–Ω–µ—Ä–µ') {
        showAboutTrainer(chatId);
    } else if (text === 'üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã') {
        showContacts(chatId);
    } else if (text === '‚≠ê –û—Ç–∑—ã–≤—ã') {
        showReviews(chatId);
    } else if (text === '‚ùì FAQ') {
        showFAQ(chatId);
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∑–∞–ø—Ä–æ—Å–æ–≤
bot.on('callback_query', (callbackQuery) => {
    const message = callbackQuery.message;
    const chatId = message.chat.id;
    const data = callbackQuery.data;
    
    if (data.startsWith('program_')) {
        const programKey = data.replace('program_', '');
        showProgramDetails(chatId, programKey);
    } else if (data === 'book_program') {
        bookProgram(chatId);
    } else if (data === 'back_to_menu') {
        bot.sendMessage(chatId, 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:', getMainMenu());
    } else if (data.startsWith('quiz_')) {
        handleQuizAnswer(chatId, data);
    }
    
    bot.answerCallbackQuery(callbackQuery.id);
});

// –ó–∞–ø—É—Å–∫ –∫–≤–∏–∑–∞
function startQuiz(chatId) {
    userStates.set(chatId, {
        step: 0,
        answers: {}
    });
    
    sendQuizQuestion(chatId, 0);
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ –∫–≤–∏–∑–∞
function sendQuizQuestion(chatId, questionIndex) {
    const question = quizQuestions[questionIndex];
    const options = question.options.map(option => ({
        text: option.text,
        callback_data: `quiz_${questionIndex}_${option.value}`
    }));
    
    const keyboard = [];
    for (let i = 0; i < options.length; i += 2) {
        keyboard.push(options.slice(i, i + 2));
    }
    
    bot.sendMessage(chatId, question.question, {
        reply_markup: {
            inline_keyboard: keyboard
        }
    });
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –∫–≤–∏–∑–∞
function handleQuizAnswer(chatId, data) {
    const parts = data.split('_');
    const questionIndex = parseInt(parts[1]);
    const answer = parts[2];
    
    const userState = userStates.get(chatId);
    if (!userState) return;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
    const answerKeys = ['goal', 'frequency', 'location', 'level', 'motivation'];
    userState.answers[answerKeys[questionIndex]] = answer;
    
    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
    if (questionIndex < quizQuestions.length - 1) {
        userState.step = questionIndex + 1;
        sendQuizQuestion(chatId, questionIndex + 1);
    } else {
        // –ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é
        finishQuiz(chatId, userState.answers);
    }
}

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–∏–∑–∞
function finishQuiz(chatId, answers) {
    const recommendedProgramKey = recommendProgram(answers);
    const program = programs[recommendedProgramKey];
    
    const message = `üéâ –û—Ç–ª–∏—á–Ω–æ! –ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!

–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É:

üèÜ **${program.name}**
üí∞ –¶–µ–Ω–∞: ${program.price}
üìù –û–ø–∏—Å–∞–Ω–∏–µ: ${program.description}

‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
${program.features.map(feature => `‚Ä¢ ${feature}`).join('\n')}

–•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç—Ç—É –ø—Ä–æ–≥—Ä–∞–º–º—É –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã?`;

    bot.sendMessage(chatId, message, {
        reply_markup: {
            inline_keyboard: [
                [
                    { text: 'üìû –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É', callback_data: 'book_program' },
                    { text: 'üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã', callback_data: 'show_all_programs' }
                ],
                [
                    { text: 'üîô –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', callback_data: 'back_to_menu' }
                ]
            ]
        }
    });
    
    userStates.delete(chatId);
}

// –ü–æ–∫–∞–∑ –ø—Ä–æ–≥—Ä–∞–º–º
function showPrograms(chatId) {
    const message = `üìã **–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫:**

${Object.values(programs).map(program => 
    `‚Ä¢ **${program.name}** - ${program.price}`
).join('\n')}

–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:`;

    bot.sendMessage(chatId, message, getProgramsMenu());
}

// –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
function showProgramDetails(chatId, programKey) {
    const program = programs[programKey];
    
    const message = `üèÜ **${program.name}**
üí∞ **–¶–µ–Ω–∞:** ${program.price}

üìù **–û–ø–∏—Å–∞–Ω–∏–µ:**
${program.description}

‚ú® **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
${program.features.map(feature => `‚Ä¢ ${feature}`).join('\n')}

–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å? –ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É!`;

    bot.sendMessage(chatId, message, {
        reply_markup: {
            inline_keyboard: [
                [
                    { text: 'üìû –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É', callback_data: 'book_program' }
                ],
                [
                    { text: 'üîô –ö —Å–ø–∏—Å–∫—É –ø—Ä–æ–≥—Ä–∞–º–º', callback_data: 'back_to_programs' }
                ]
            ]
        }
    });
}

// –ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É
function bookProgram(chatId) {
    const message = `üìû **–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É**

–î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É —Å–≤—è–∂–∏—Ç–µ—Å—å —Å —Ç—Ä–µ–Ω–µ—Ä–æ–º:

üì± **–¢–µ–ª–µ—Ñ–æ–Ω:** +7 915 299 4659
üìß **Telegram:** @liliya_fit_trainer

–ò–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —á–∞—Ç –ø–æ –Ω–æ–º–µ—Ä—É: +7 915 299 4659

–õ–∏–ª–∏—è –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ –≤—Å–µ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É! üí™`;

    bot.sendMessage(chatId, message, {
        reply_markup: {
            inline_keyboard: [
                [
                    { text: 'üì± –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç', url: 'https://t.me/+79152994659' }
                ],
                [
                    { text: 'üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é', callback_data: 'back_to_menu' }
                ]
            ]
        }
    });
}

// –û —Ç—Ä–µ–Ω–µ—Ä–µ
function showAboutTrainer(chatId) {
    const message = `üë©‚Äçüíº **–û —Ç—Ä–µ–Ω–µ—Ä–µ - –õ–∏–ª–∏—è –Ø—Ü–∫–∞—è**

üí™ **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**
‚Ä¢ –§–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä —Å 5+ –ª–µ—Ç –æ–ø—ã—Ç–∞
‚Ä¢ –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –ø–æ—Å–ª–µ —Ä–æ–¥–æ–≤
‚Ä¢ –¢—Ä–µ–Ω–µ—Ä –ø–æ TRX –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É —Ç—Ä–µ–Ω–∏–Ω–≥—É
‚Ä¢ –≠–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–∏—Ç–∞–Ω–∏—é –∏ –∑–¥–æ—Ä–æ–≤–æ–º—É –æ–±—Ä–∞–∑—É –∂–∏–∑–Ω–∏

üèÜ **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
‚Ä¢ –ü–æ–º–æ–≥–ª–∞ 500+ –∫–ª–∏–µ–Ω—Ç–∞–º –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–µ–π
‚Ä¢ –°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –ø–æ TRX
‚Ä¢ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∂–µ–Ω—â–∏–Ω–∞–º–∏ –ø–æ—Å–ª–µ —Ä–æ–¥–æ–≤
‚Ä¢ –ê–≤—Ç–æ—Ä —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

üéØ **–ü–æ–¥—Ö–æ–¥:**
–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è.

–õ–∏–ª–∏—è –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –¥–æ—Å—Ç–∏—á—å –ª—é–±—ã—Ö —Ü–µ–ª–µ–π! üí™`;

    bot.sendMessage(chatId, message, {
        reply_markup: {
            inline_keyboard: [
                [
                    { text: 'üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å —Ç—Ä–µ–Ω–µ—Ä–æ–º', callback_data: 'book_program' }
                ],
                [
                    { text: 'üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é', callback_data: 'back_to_menu' }
                ]
            ]
        }
    });
}

// –ö–æ–Ω—Ç–∞–∫—Ç—ã
function showContacts(chatId) {
    const message = `üìû **–ö–æ–Ω—Ç–∞–∫—Ç—ã —Ç—Ä–µ–Ω–µ—Ä–∞**

üì± **–¢–µ–ª–µ—Ñ–æ–Ω:** +7 915 299 4659
üìß **Telegram:** @liliya_fit_trainer
üåê **Instagram:** @liliya_fit_trainer

üìç **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ú–æ—Å–∫–≤–∞
üïê **–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** –ü–Ω-–í—Å 8:00-22:00

üí¨ **–°–ø–æ—Å–æ–±—ã —Å–≤—è–∑–∏:**
‚Ä¢ –ü—Ä—è–º–æ–π –∑–≤–æ–Ω–æ–∫
‚Ä¢ Telegram —á–∞—Ç
‚Ä¢ WhatsApp
‚Ä¢ –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Instagram

–°–≤—è–∂–∏—Ç–µ—Å—å –ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º! –õ–∏–ª–∏—è –æ—Ç–≤–µ—Ç–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞. ‚ö°`;

    bot.sendMessage(chatId, message, {
        reply_markup: {
            inline_keyboard: [
                [
                    { text: 'üì± –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç', url: 'https://t.me/+79152994659' }
                ],
                [
                    { text: 'üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é', callback_data: 'back_to_menu' }
                ]
            ]
        }
    });
}

// –û—Ç–∑—ã–≤—ã
function showReviews(chatId) {
    const message = `‚≠ê **–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤**

üí¨ **–ê–Ω–Ω–∞, 28 –ª–µ—Ç:**
"–ó–∞–Ω–∏–º–∞—é—Å—å —Å –õ–∏–ª–µ–π —É–∂–µ 6 –º–µ—Å—è—Ü–µ–≤. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–≤–∑–æ—à–µ–ª –≤—Å–µ –æ–∂–∏–¥–∞–Ω–∏—è! –ú–∏–Ω—É—Å 15 –∫–≥, –ø–æ–¥—Ç—è–Ω—É—Ç–æ–µ —Ç–µ–ª–æ –∏ –æ—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ. –õ–∏–ª—è - –Ω–∞—Å—Ç–æ—è—â–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª!"

üí¨ **–ú–∞—Ä–∏—è, 32 –≥–æ–¥–∞:**
"–ü–æ—Å–ª–µ —Ä–æ–¥–æ–≤ –¥—É–º–∞–ª–∞, —á—Ç–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–µ—Ä–Ω—É—Å—å –≤ —Ñ–æ—Ä–º—É. –õ–∏–ª—è –ø–æ–º–æ–≥–ª–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è, –Ω–æ –∏ —Å—Ç–∞—Ç—å –ª—É—á—à–µ, —á–µ–º –¥–æ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏. –°–ø–∞—Å–∏–±–æ!"

üí¨ **–ï–ª–µ–Ω–∞, 25 –ª–µ—Ç:**
"–ü—Ä–æ–≥—Ä–∞–º–º–∞ TRX –ë–∞–ª–∞–Ω—Å - —ç—Ç–æ —á—Ç–æ-—Ç–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–µ! –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–¥–µ–Ω —É–∂–µ —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü. –†–µ–∫–æ–º–µ–Ω–¥—É—é –≤—Å–µ–º!"

üí¨ **–û–ª—å–≥–∞, 30 –ª–µ—Ç:**
"–õ–∏–ª—è –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç—Ä–µ–Ω–µ—Ä, –∞ –Ω–∞—Å—Ç–æ—è—â–∏–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç, –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç, –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏. –ë–ª–∞–≥–æ–¥–∞—Ä—è –µ–π –ø–æ–ª—é–±–∏–ª–∞ —Å–ø–æ—Ä—Ç!"

üí¨ **–ò—Ä–∏–Ω–∞, 35 –ª–µ—Ç:**
"–†–∞—Å—Ç—è–∂–∫–∞ –∏ —à–ø–∞–≥–∞—Ç - –º–µ—á—Ç–∞ –¥–µ—Ç—Å—Ç–≤–∞ —Å–±—ã–ª–∞—Å—å! –õ–∏–ª—è –ø–æ–º–æ–≥–ª–∞ —Å–µ—Å—Ç—å –Ω–∞ —à–ø–∞–≥–∞—Ç –∑–∞ 3 –º–µ—Å—è—Ü–∞. –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ!"

–•–æ—Ç–∏—Ç–µ —Å—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º —É—Å–ø–µ—à–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º? –ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å! üí™`;

    bot.sendMessage(chatId, message, {
        reply_markup: {
            inline_keyboard: [
                [
                    { text: 'üìû –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É', callback_data: 'book_program' }
                ],
                [
                    { text: 'üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é', callback_data: 'back_to_menu' }
                ]
            ]
        }
    });
}

// FAQ
function showFAQ(chatId) {
    const message = `‚ùì **–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã**

**Q: –° –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –º–æ–∂–Ω–æ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è?**
A: –ü—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –∂–µ–Ω—â–∏–Ω –æ—Ç 16 –ª–µ—Ç. –ï—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–æ–¥–æ–≤.

**Q: –ù—É–∂–Ω–æ –ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ?**
A: –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–≥—Ä–∞–º–º —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –Ω–∞ –¥–æ–º–∞—à–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –î–ª—è TRX –ë–∞–ª–∞–Ω—Å –Ω—É–∂–Ω—ã –ø–µ—Ç–ª–∏ TRX.

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ—Ö–æ–¥—è—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏?**
A: –ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã - –æ—Ç 1-2 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –¥–æ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏?**
A: –î–∞, –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –≤—Ä–∞—á–æ–º.

**Q: –ß—Ç–æ –µ—Å–ª–∏ —è –ø—Ä–æ–ø—É—â—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?**
A: –í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –≥–∏–±–∫–∏–µ, –º–æ–∂–Ω–æ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –≤ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è. –õ–∏–ª—è –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π.

**Q: –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–ø–ª–∞—Ç–∞?**
A: –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ø—Ä–æ–≥—Ä–∞–º–º—ã. –î–æ—Å—Ç—É–ø–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É?**
A: –î–∞, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –ø–æ–∂–µ–ª–∞–Ω–∏–π.

–ï—Å—Ç—å –¥—Ä—É–≥–∏–µ –≤–æ–ø—Ä–æ—Å—ã? –°–≤—è–∂–∏—Ç–µ—Å—å —Å —Ç—Ä–µ–Ω–µ—Ä–æ–º! üí¨`;

    bot.sendMessage(chatId, message, {
        reply_markup: {
            inline_keyboard: [
                [
                    { text: 'üìû –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å —Ç—Ä–µ–Ω–µ—Ä—É', callback_data: 'book_program' }
                ],
                [
                    { text: 'üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é', callback_data: 'back_to_menu' }
                ]
            ]
        }
    });
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
bot.on('polling_error', (error) => {
    console.error('‚ùå –û—à–∏–±–∫–∞ polling:', error);
});

bot.on('error', (error) => {
    console.error('‚ùå –û—à–∏–±–∫–∞ –±–æ—Ç–∞:', error);
});

// –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
console.log('üöÄ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
console.log('üì± –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C');

// Graceful shutdown
process.on('SIGINT', () => {
    console.log('\nüõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞...');
    bot.stopPolling();
    process.exit(0);
});